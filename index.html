<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blank page with scroll</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  
  <!-- Dropdown nh·ªè g√≥c tr√°i -->
    <!-- Dropdown nh·ªè g√≥c tr√°i -->
  <div class="dropdown-box">
    <button class="dropdown-btn" id="definedByBtn">Defined by ‚ñº</button>
    <div class="dropdown-menu" id="definedByMenu">
      <div class="option">Karnaugh map</div>
      <div class="option">Minterm</div>
      <div class="option">Maxterm</div>
      <div class="option">Boolean Expression</div>
      <div class="option">Truth Table</div>
    </div>
  </div>

  <!-- Dropdown variables -->
  <div class="var-box">
    <button class="var-selected" id="varSelected">4 variables ‚ñº</button>
    <div class="var-menu" id="varMenu">
      <div class="var-option">2 variables</div>
      <div class="var-option">3 variables</div>
      <div class="var-option">4 variables</div>
      <div class="var-option">5 variables</div>
      <div class="var-option">6 variables</div>
    </div>
  </div>

  <!-- K-map 2 variables -->
<div id="kmap2" class="kmap hidden">

  <div class="kmap-header">
    <div></div>
    <div>B = 0</div>
    <div>B = 1</div>
  </div>

  <div class="kmap-row">
    <div class="row-label">A = 0</div>
    <div class="cell state-0" data-minterm="0">0</div>
    <div class="cell state-0" data-minterm="1">0</div>
  </div>

  <div class="kmap-row">
    <div class="row-label">A = 1</div>
    <div class="cell state-0" data-minterm="2">0</div>
    <div class="cell state-0" data-minterm="3">0</div>
  </div>

  <!-- l·ªõp ƒë·ªÉ v·∫Ω group sau n√†y -->
  <div class="groups"></div>
</div>

  
  <script>
    const kmap2 = document.getElementById("kmap2");
    const definedByBtn = document.getElementById("definedByBtn");
    const definedByMenu = document.getElementById("definedByMenu");
    const varSelected = document.getElementById("varSelected");
    const varMenu = document.getElementById("varMenu");

    definedByBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      if (varMenu.classList.contains("show")) {
        varMenu.classList.remove("show");
      }
      definedByMenu.classList.toggle("show");
    });

    varSelected.addEventListener("click", (e) => {
      e.stopPropagation();
      if (definedByMenu.classList.contains("show")) {
        definedByMenu.classList.remove("show");
      }
      varMenu.classList.toggle("show");
    });

    definedByMenu.querySelectorAll(".option").forEach(option => {
      option.addEventListener("click", () => {
        definedByMenu.classList.remove("show");
      });
    });

    varMenu.querySelectorAll(".var-option").forEach(option => {
      option.addEventListener("click", () => {
        const value = option.innerText;
    
        varSelected.innerText = value + " ‚ñº";
        varMenu.classList.remove("show");
    
        // üëâ HI·ªÜN / ·∫®N K-map 2 variables
        if (value === "2 variables") {
          kmap2.classList.remove("hidden");
        } else {
          kmap2.classList.add("hidden");
        }
      });
    });

    window.addEventListener("click", () => {
      definedByMenu.classList.remove("show");
      varMenu.classList.remove("show");
    });
    // ===== K-map cell state: 0 ‚Üí 1 ‚Üí X ‚Üí 0 =====
    const cells = document.querySelectorAll("#kmap2 .cell");
    
    cells.forEach(cell => {
      cell.addEventListener("click", (e) => {
        e.stopPropagation(); // tr√°nh click l√†m ƒë√≥ng dropdown
    
        if (cell.classList.contains("state-0")) {
          // 0 ‚Üí 1
          cell.classList.remove("state-0");
          cell.classList.add("state-1");
          cell.textContent = "1";
    
        } else if (cell.classList.contains("state-1")) {
          // 1 ‚Üí X
          cell.classList.remove("state-1");
          cell.classList.add("state-x");
          cell.textContent = "X";
    
        } else {
          // X ‚Üí 0
          cell.classList.remove("state-x");
          cell.classList.add("state-0");
          cell.textContent = "0";
        }
      });
    });
    // H√†m ki·ªÉm tra √¥ c√≥ gi√° tr·ªã l√† 1 ho·∫∑c X (ƒë·ªÉ nh√≥m ƒë∆∞·ª£c)
function isGroupable(cell) {
  return cell.classList.contains("state-1") || cell.classList.contains("state-x");
}

// T√¨m √¥ d·ª±a v√†o data-minterm, tr·∫£ v·ªÅ DOM element
function getCellByMinterm(minterm) {
  return kmap2.querySelector(`.cell[data-minterm="${minterm}"]`);
}

// T√≠nh v·ªã tr√≠ v√† k√≠ch th∆∞·ªõc c·ªßa c√°c nh√≥m, r·ªìi v·∫Ω khung
function drawGroups() {
  const groupsContainer = kmap2.querySelector(".groups");
  groupsContainer.innerHTML = ""; // X√≥a khung c≈©

  // L·∫•y tr·∫°ng th√°i c√°c √¥ (index 0 ƒë·∫øn 3)
  // Minterm 0 1
  //         2 3
  const cells = [
    getCellByMinterm(0),
    getCellByMinterm(1),
    getCellByMinterm(2),
    getCellByMinterm(3)
  ];

  // T·∫°o m·∫£ng boolean ƒë√°nh d·∫•u √¥ group ƒë∆∞·ª£c (1 ho·∫∑c X)
  const groupable = cells.map(cell => isGroupable(cell));

  // C√°c nh√≥m c√≥ th·ªÉ c√≥ trong 2 bi·∫øn:
  // Nh√≥m ƒë∆°n (1 √¥)
  // Nh√≥m ƒë√¥i (2 √¥ c·∫°nh nhau)
  // Nh√≥m b·ªën (t·∫•t c·∫£ 4 √¥)

  // Ki·ªÉm tra nh√≥m 4 √¥ (to√†n b·ªô k-map)
  if (groupable.every(Boolean)) {
    drawGroup([0,1,2,3]);
    return; // Nh√≥m 4 ph·ªß h·∫øt r·ªìi, kh√¥ng c·∫ßn nh√≥m nh·ªè h∆°n
  }

  // Nh√≥m ƒë√¥i theo h√†ng
  if (groupable[0] && groupable[1]) drawGroup([0,1]);
  if (groupable[2] && groupable[3]) drawGroup([2,3]);

  // Nh√≥m ƒë√¥i theo c·ªôt
  if (groupable[0] && groupable[2]) drawGroup([0,2]);
  if (groupable[1] && groupable[3]) drawGroup([1,3]);

  // Nh√≥m ƒë∆°n l·∫ª (kh√¥ng thu·ªôc nh√≥m n√†o)
  for (let i=0; i<4; i++) {
    // N·∫øu √¥ kh√¥ng n·∫±m trong nh√≥m n√†o tr√™n th√¨ t·∫°o nh√≥m ƒë∆°n
    // ·ªû ƒë√¢y ƒë∆°n gi·∫£n: t·∫°o nh√≥m ƒë∆°n v·ªõi c√°c √¥ kh√¥ng n·∫±m trong nh√≥m ƒë√¥i/4
    // V√¨ kh√¥ng l∆∞u tr·∫°ng th√°i nh√≥m, ta v·∫Ω ƒë∆°n t·∫•t c·∫£ c√°c √¥ groupable
    // ƒêi·ªÅu n√†y s·∫Ω l√†m tr√πng nh√≥m nh∆∞ng OK ƒë·ªÉ demo ƒë∆°n gi·∫£n
    if (groupable[i]) {
      drawGroup([i]);
    }
  }
}

  // V·∫Ω khung nh√≥m, tham s·ªë l√† m·∫£ng ch·ªâ s·ªë c√°c √¥ trong nh√≥m
  function drawGroup(cellsInGroup) {
    const groupsContainer = kmap2.querySelector(".groups");
  
    // T√≠nh v·ªã tr√≠ v√† k√≠ch th∆∞·ªõc d·ª±a tr√™n v·ªã tr√≠ √¥ ƒë·∫ßu v√† cu·ªëi trong nh√≥m
    const cellElems = cellsInGroup.map(i => getCellByMinterm(i));
  
    // L·∫•y v·ªã tr√≠ bounding box c·ªßa c√°c √¥
    const rects = cellElems.map(cell => cell.getBoundingClientRect());
  
    // L·∫•y bounding box c·ªßa container ƒë·ªÉ t√≠nh to√°n v·ªã tr√≠ t∆∞∆°ng ƒë·ªëi
    const containerRect = kmap2.getBoundingClientRect();
  
    // T√≠nh v·ªã tr√≠ bao quanh nh√≥m
    const left = Math.min(...rects.map(r => r.left)) - containerRect.left - 6; // cƒÉn ch·ªânh h∆°i ra ngo√†i vi·ªÅn cell
    const top = Math.min(...rects.map(r => r.top)) - containerRect.top - 6;
    const right = Math.max(...rects.map(r => r.right)) - containerRect.left + 6;
    const bottom = Math.max(...rects.map(r => r.bottom)) - containerRect.top + 6;
  
    const width = right - left;
    const height = bottom - top;
  
    // T·∫°o div group v√† set style
    const groupDiv = document.createElement("div");
    groupDiv.classList.add("group");
    groupDiv.style.left = left + "px";
    groupDiv.style.top = top + "px";
    groupDiv.style.width = width + "px";
    groupDiv.style.height = height + "px";
  
    groupsContainer.appendChild(groupDiv);
  }
  
  // G·ªçi l·∫°i m·ªói khi thay ƒë·ªïi tr·∫°ng th√°i √¥
  cells.forEach(cell => {
    cell.addEventListener("click", () => {
      // Delay 0 ƒë·ªÉ sau khi thay ƒë·ªïi tr·∫°ng th√°i trong event click ban ƒë·∫ßu
      setTimeout(drawGroups, 0);
    });
  });
  
  // G·ªçi l·∫ßn ƒë·∫ßu ƒë·ªÉ kh√¥ng c√≥ nh√≥m khi kh·ªüi t·∫°o
  drawGroups();
  </script>

</body>
</html>
