<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boolean Expression Simplifier</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Boolean algebra simplifier -->
  <script src="https://cdn.jsdelivr.net/npm/boolean-expression-simplifier/dist/bundle.min.js" defer></script>
</head>
<body>

<!-- ================= UI ================= -->

<div class="dropdown-box">
  <button class="dropdown-btn" id="definedByBtn">Defined by ▼</button>
  <div class="dropdown-menu" id="definedByMenu">
    <div class="option">Karnaugh map</div>
    <div class="option">Boolean Expression</div>
    <div class="option">Minterm</div>
    <div class="option">Maxterm</div>
    <div class="option">Truth Table</div>
  </div>
</div>

<div class="var-box">
  <button class="var-selected" id="varSelected">4 variables ▼</button>
  <div class="var-menu" id="varMenu">
    <div class="var-option">2 variables</div>
    <div class="var-option">3 variables</div>
    <div class="var-option">4 variables</div>
    <div class="var-option">5 variables</div>
    <div class="var-option">6 variables</div>
  </div>
</div>

<div class="expr-container">
  <div class="expr-title">Boolean Expression</div>

  <div class="expr-row">
    <label>Standard expression:</label>
    <input type="text" id="standardExpr" autocomplete="off" />
  </div>

  <div class="expr-row">
    <label>Don't care terms:</label>
    <input type="text" id="dontCareExpr" autocomplete="off" />
  </div>

  <div class="expr-row">
    <label>Simplified expression:</label>
    <input type="text" id="simplifiedExpr" disabled />
  </div>

  <button id="instructionBtn">Instruction</button>
</div>

<div class="popup-overlay" id="popupOverlay">
  <div class="popup">
    <h3>Instruction</h3>
    <pre id="instructionContent"></pre>
  </div>
</div>

<!-- ================= SCRIPT ================= -->

<script>
/* ---------- Elements ---------- */
const definedByBtn = document.getElementById("definedByBtn");
const definedByMenu = document.getElementById("definedByMenu");
const varSelected = document.getElementById("varSelected");
const varMenu = document.getElementById("varMenu");
const instructionBtn = document.getElementById("instructionBtn");
const popupOverlay = document.getElementById("popupOverlay");
const popup = popupOverlay.querySelector(".popup");
const instructionContent = document.getElementById("instructionContent");
const standardExpr = document.getElementById("standardExpr");
const simplifiedExpr = document.getElementById("simplifiedExpr");

/* ---------- Variables ---------- */
const VARS = ["A", "B", "C", "D", "E", "F"];
let variableCount = 4;

/* ---------- Dropdown ---------- */
definedByBtn.onclick = e => {
  e.stopPropagation();
  varMenu.classList.remove("show");
  definedByMenu.classList.toggle("show");
};

varSelected.onclick = e => {
  e.stopPropagation();
  definedByMenu.classList.remove("show");
  varMenu.classList.toggle("show");
};

window.onclick = () => {
  definedByMenu.classList.remove("show");
  varMenu.classList.remove("show");
};

varMenu.querySelectorAll(".var-option").forEach(opt => {
  opt.onclick = () => {
    variableCount = parseInt(opt.innerText);
    varSelected.innerText = opt.innerText + " ▼";
    varMenu.classList.remove("show");
    updateInstruction();
  };
});

/* ---------- Instruction ---------- */
function updateInstruction() {
  instructionContent.textContent = `
Allowed variables: ${VARS.slice(0, variableCount).join(", ")}

Operators:
+  : OR
*  : AND
'  : NOT
x  : XOR
( ) : Group

Invalid characters will be removed automatically.
  `;
}
updateInstruction();

/* ---------- Popup ---------- */
instructionBtn.onclick = e => {
  e.stopPropagation();
  popupOverlay.style.display =
    popupOverlay.style.display === "block" ? "none" : "block";
};

popupOverlay.onclick = () => popupOverlay.style.display = "none";
popup.onclick = e => e.stopPropagation();

/* ---------- XOR → SOP ---------- */
function convertXORtoStandard(expr) {
  let result = expr;
  const xorRegex = /([A-Z])\s*x\s*([A-Z])/;
  while (xorRegex.test(result)) {
    result = result.replace(xorRegex, "($1'*$2+$1*$2')");
  }
  return result;
}

/* ---------- Simplify ---------- */
standardExpr.addEventListener("input", () => {
  const allowedVars = VARS.slice(0, variableCount);
  const allowedOps = ["+", "*", "'", "x", "(", ")", " "];

  let cleaned = "";
  for (let ch of standardExpr.value.toUpperCase()) {
    if (allowedVars.includes(ch) || allowedOps.includes(ch)) {
      cleaned += ch;
    }
  }
  standardExpr.value = cleaned;

  if (!cleaned.trim()) {
    simplifiedExpr.value = "";
    return;
  }

  try {
    simplifiedExpr.value =
      BooleanExpressionSimplifier.simplify(
        convertXORtoStandard(cleaned)
      );
  } catch {
    simplifiedExpr.value = "Invalid expression";
  }
});
</script>

</body>
</html>
