<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blank page with scroll</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  
  <!-- Dropdown nhỏ góc trái -->
    <!-- Dropdown nhỏ góc trái -->
  <div class="dropdown-box">
    <button class="dropdown-btn" id="definedByBtn">Defined by ▼</button>
    <div class="dropdown-menu" id="definedByMenu">
      <div class="option">Karnaugh map</div>
      <div class="option">Minterm</div>
      <div class="option">Maxterm</div>
      <div class="option">Boolean Expression</div>
      <div class="option">Truth Table</div>
    </div>
  </div>

  <!-- Dropdown variables -->
  <div class="var-box">
    <button class="var-selected" id="varSelected">4 variables ▼</button>
    <div class="var-menu" id="varMenu">
      <div class="var-option">2 variables</div>
      <div class="var-option">3 variables</div>
      <div class="var-option">4 variables</div>
      <div class="var-option">5 variables</div>
      <div class="var-option">6 variables</div>
    </div>
  </div>

  <!-- K-map 2 variables -->
<div id="kmap2" class="kmap hidden">

  <div class="kmap-header">
    <div></div>
    <div>B = 0</div>
    <div>B = 1</div>
  </div>

  <div class="kmap-row">
    <div class="row-label">A = 0</div>
    <div class="cell state-0" data-minterm="0">0</div>
    <div class="cell state-0" data-minterm="1">0</div>
  </div>

  <div class="kmap-row">
    <div class="row-label">A = 1</div>
    <div class="cell state-0" data-minterm="2">0</div>
    <div class="cell state-0" data-minterm="3">0</div>
  </div>

  <!-- lớp để vẽ group sau này -->
  <div class="groups"></div>
</div>

  
  <script>
  const kmap2 = document.getElementById("kmap2");
  const definedByBtn = document.getElementById("definedByBtn");
  const definedByMenu = document.getElementById("definedByMenu");
  const varSelected = document.getElementById("varSelected");
  const varMenu = document.getElementById("varMenu");
  
  // --- Dropdown ---
  definedByBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    if (varMenu.classList.contains("show")) varMenu.classList.remove("show");
    definedByMenu.classList.toggle("show");
  });
  
  varSelected.addEventListener("click", (e) => {
    e.stopPropagation();
    if (definedByMenu.classList.contains("show")) definedByMenu.classList.remove("show");
    varMenu.classList.toggle("show");
  });
  
  definedByMenu.querySelectorAll(".option").forEach(option => {
    option.addEventListener("click", () => definedByMenu.classList.remove("show"));
  });
  
  varMenu.querySelectorAll(".var-option").forEach(option => {
    option.addEventListener("click", () => {
      const value = option.innerText;
      varSelected.innerText = value + " ▼";
      varMenu.classList.remove("show");
  
      if (value === "2 variables") kmap2.classList.remove("hidden");
      else kmap2.classList.add("hidden");
    });
  });
  
  window.addEventListener("click", () => {
    definedByMenu.classList.remove("show");
    varMenu.classList.remove("show");
  });
  
  // --- Cell state 0 → 1 → X → 0 ---
  const cells = document.querySelectorAll("#kmap2 .cell");
  
  cells.forEach(cell => {
    cell.addEventListener("click", (e) => {
      e.stopPropagation();
      if (cell.classList.contains("state-0")) {
        cell.classList.replace("state-0","state-1"); cell.textContent="1";
      } else if (cell.classList.contains("state-1")) {
        cell.classList.replace("state-1","state-x"); cell.textContent="X";
      } else {
        cell.classList.replace("state-x","state-0"); cell.textContent="0";
      }
      setTimeout(drawGroups, 0);
    });
  });
  
  // --- Kiểm tra ô group được ---
  function isGroupable(cell) {
    return cell.classList.contains("state-1") || cell.classList.contains("state-x");
  }
  
  // --- Lấy ô theo minterm ---
  function getCellByMinterm(minterm) {
    return kmap2.querySelector(`.cell[data-minterm="${minterm}"]`);
  }
  
  // --- Vẽ các nhóm ---
  function drawGroups() {
    const groupsContainer = kmap2.querySelector(".groups");
    groupsContainer.innerHTML = ""; // xóa cũ
  
    const cellsArr = [0,1,2,3].map(i => getCellByMinterm(i));
    const groupable = cellsArr.map(cell => isGroupable(cell));
  
    // Nhóm 4 ô
    if (groupable.every(Boolean)) {
      drawGroup([0,1,2,3],"group");
      return;
    }
  
    // Nhóm đôi hàng (màu cam)
    if (groupable[0] && groupable[1]) drawGroup([0,1],"group");
    if (groupable[2] && groupable[3]) drawGroup([2,3],"group");
  
    // Nhóm đôi cột (màu xanh để phân biệt)
    if (groupable[0] && groupable[2]) drawGroup([0,2],"group-alt");
    if (groupable[1] && groupable[3]) drawGroup([1,3],"group-alt");
  
    // Nhóm đơn (những ô chưa có nhóm)
    for (let i=0;i<4;i++){
      if(groupable[i]){
        const alreadyGrouped = Array.from(groupsContainer.children)
          .some(g => g.dataset.cells.split(",").includes(i.toString()));
        if(!alreadyGrouped) drawGroup([i],"group");
      }
    }
  }
  
  // --- Vẽ 1 nhóm ---
  function drawGroup(cellsInGroup,className="group"){
    const groupsContainer = kmap2.querySelector(".groups");
    const cellElems = cellsInGroup.map(i => getCellByMinterm(i));
    const rects = cellElems.map(c => c.getBoundingClientRect());
    const containerRect = kmap2.getBoundingClientRect();
  
    const left = Math.min(...rects.map(r=>r.left))-containerRect.left-6;
    const top = Math.min(...rects.map(r=>r.top))-containerRect.top-6;
    const right = Math.max(...rects.map(r=>r.right))-containerRect.left+6;
    const bottom = Math.max(...rects.map(r=>r.bottom))-containerRect.top+6;
  
    const groupDiv = document.createElement("div");
    groupDiv.classList.add(className);
    groupDiv.dataset.cells = cellsInGroup.join(",");
    groupDiv.style.left = left+"px";
    groupDiv.style.top = top+"px";
    groupDiv.style.width = (right-left)+"px";
    groupDiv.style.height = (bottom-top)+"px";
  
    groupsContainer.appendChild(groupDiv);
  }
  
  // --- Gọi lần đầu ---
  drawGroups();
  </script>


</body>
</html>
