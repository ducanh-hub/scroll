<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boolean Expression Simplifier</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Boolean Expression Simplifier -->
  <script src="https://cdn.jsdelivr.net/npm/boolean-expression-simplifier/dist/bundle.min.js" defer></script>
</head>

<body>

  <!-- ===== Dropdown Defined By ===== -->
  <div class="dropdown-box">
    <button class="dropdown-btn" id="definedByBtn">Defined by ▼</button>
    <div class="dropdown-menu" id="definedByMenu">
      <div class="option">Karnaugh map</div>
      <div class="option">Boolean Expression</div>
      <div class="option">Minterm</div>
      <div class="option">Maxterm</div>
      <div class="option">Truth Table</div>
    </div>
  </div>

  <!-- ===== Dropdown Variables ===== -->
  <div class="var-box">
    <button class="var-selected" id="varSelected">4 variables ▼</button>
    <div class="var-menu" id="varMenu">
      <div class="var-option">2 variables</div>
      <div class="var-option">3 variables</div>
      <div class="var-option">4 variables</div>
      <div class="var-option">5 variables</div>
      <div class="var-option">6 variables</div>
    </div>
  </div>

  <!-- ===== Boolean Expression Workspace ===== -->
  <div class="expr-container">
    <div class="expr-title">Boolean Expression</div>

    <div class="expr-row">
      <label>Standard expression:</label>
      <input type="text" id="standardExpr" autocomplete="off" />
    </div>

    <div class="expr-row">
      <label>Don't care terms:</label>
      <input type="text" id="dontCareExpr" autocomplete="off" />
    </div>

    <div class="expr-row">
      <label>Simplified expression:</label>
      <input type="text" id="simplifiedExpr" disabled />
    </div>

    <button id="instructionBtn">Instruction</button>
  </div>

  <!-- ===== Instruction Popup ===== -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup">
      <h3>Instruction</h3>
      <pre id="instructionContent"></pre>
    </div>
  </div>

<script>
window.onload = () => {

  const VARS = ["A", "B", "C", "D", "E", "F"];
  let variableCount = 4;

  const standardExpr = document.getElementById("standardExpr");
  const simplifiedExpr = document.getElementById("simplifiedExpr");

  // ===== Instruction =====
  const instructionContent = document.getElementById("instructionContent");
  function updateInstruction() {
    instructionContent.textContent = `
Allowed variables: ${VARS.slice(0, variableCount).join(", ")}

Operators:
+  : OR
*  : AND
'  : NOT
x  : XOR
( ) : Group
    `;
  }
  updateInstruction();

  // ===== XOR convert =====
  function convertXOR(expr) {
    const xorRegex = /([A-Z])x([A-Z])/;
    while (xorRegex.test(expr)) {
      expr = expr.replace(xorRegex, "($1'*$2+$1*$2')");
    }
    return expr;
  }

  // ===== Convert to library syntax =====
  function toLibrarySyntax(expr) {
    return expr
      .replace(/([A-Z])'/g, "!$1")
      .replace(/\*/g, "&&")
      .replace(/\+/g, "||");
  }

  // ===== Input handler =====
  standardExpr.addEventListener("input", () => {

    const allowedVars = VARS.slice(0, variableCount);
    const allowedOps = ["+", "*", "'", "x", "(", ")"];

    let cleaned = "";
    for (let ch of standardExpr.value.toUpperCase()) {
      if (allowedVars.includes(ch) || allowedOps.includes(ch)) {
        cleaned += ch;
      }
    }

    if (cleaned !== standardExpr.value) {
      standardExpr.value = cleaned;
    }

    if (cleaned === "") {
      simplifiedExpr.value = "";
      return;
    }

    try {
      const noSpace = cleaned.replace(/\s+/g, "");
      const xorConverted = convertXOR(noSpace);
      const libExpr = toLibrarySyntax(xorConverted);

      const result =
        BooleanExpressionSimplifier.simplify(libExpr);

      simplifiedExpr.value = result;
    } catch (err) {
      simplifiedExpr.value = "Invalid expression";
    }
  });

};
</script>

</body>
</html>
